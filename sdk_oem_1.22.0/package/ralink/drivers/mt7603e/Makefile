# All rights reserved.
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.

include $(TOPDIR)/rules.mk
include $(INCLUDE_DIR)/kernel.mk

PKG_NAME:=mt7603e
PKG_VERSION:=wifi_4.0.0.5_20140511

PKG_SOURCE:=$(PKG_NAME)_$(PKG_VERSION).tar.bz2
PKG_SOURCE_URL:=http://localhost/ \
    http://172.26.66.224/mtk_drivers/
PKG_BUILD_DIR:=$(KERNEL_BUILD_DIR)/$(PKG_NAME)_$(PKG_VERSION)

PKG_KCONFIG:= \
	RALINK_MT7620 RALINK_RT7621 MT_WIFI MT_WIFI_PATH\
	FIRST_MT_IF_EEPROM_PROM FIRST_MT_IF_EEPROM_EFUSE FIRST_MT_IF_EEPROM_FLASH RT_FIRST_CARD_EEPROM\
	MULTI_INF_SUPPORT MT_WSC_INCLUDED MT_WSC_V2_SUPPORT MT_DOT11N_DRAFT3 MT_DOT11_VHT_AC MT_DOT11W_PMF_SUPPORT\
	MT_TXBF_SUPPORT MT_WMM_ACM_SUPPORT MT_LLTD_SUPPORT MT_QOS_DLS_SUPPORT MT_WAPI_SUPPORT MT_CARRIER_DETECTION_SUPPORT\
	MT_IGMP_SNOOP_SUPPORT MT_BLOCK_NET_IF MT_RATE_ADAPTION MT_NEW_RATE_ADAPT_SUPPORT MT_AGS_SUPPORT\
	MT_IDS_SUPPORT MT_WIFI_WORK_QUEUE MT_WIFI_SKB_RECYCLE MT_RTMP_FLASH_SUPPORT MT_LED_CONTROL_SUPPORT\
	MT_SINGLE_SKU_V2 MT_HW_ANTENNA_DIVERSITY MT_ATE_SUPPORT MT_RT2860V2_AP_V24_DATA_STRUCTURE MT_RT2860V2_AP_32B_DESC\
	MT_MEMORY_OPTIMIZATION MT_HOTSPOT MT_HOTSPOT_R2 MT_UAPSD MT_PA_LNA RLT_BBP RLT_RF RTMP_BBP RTMP_RF\
	RTMP_PCI_SUPPORT RTMP_USB_SUPPORT RTMP_RBUS_SUPPORT MT_WIFI_MODE_AP RALINK_MT7603E MT_MAC MT_AP_SUPPORT\
	MT_WDS_SUPPORT MT_MBSS_SUPPORT MT_NEW_MBSSID_MODE MT_ENHANCE_NEW_MBSSID_MODE MT_APCLI_SUPPORT MT_MAC_REPEATER_SUPPORT\
	MT_LLTD_SUPPORT MT_NINTENDO_AP MT_COC_SUPPORT
	

PKG_CONFIG_DEPENDS:=$(foreach c, $(PKG_KCONFIG),$(if $(CONFIG_$c),CONFIG_$(c)))

include $(INCLUDE_DIR)/package.mk

define KernelPackage/mt7603e
  CATEGORY:=Ralink Properties
  TITLE:=Ralink mt7603e wifi AP driver
  FILES:=$(PKG_BUILD_DIR)/mt_wifi_ap/mt7603e.ko
  AUTOLOAD:=$(call AutoLoad,91,mt7603e)
  SUBMENU:=Drivers
  MENU:=1
endef

define KernelPackage/mt7603e/config
	source "$(SOURCE)/Config-mt7603e.in"
endef

define Build/Compile
	$(MAKE) -C "$(LINUX_DIR)" \
		CROSS_COMPILE="$(TARGET_CROSS)" \
		ARCH="$(LINUX_KARCH)" \
		SUBDIRS="$(PKG_BUILD_DIR)/mt_wifi_ap/" \
		$(foreach c, $(PKG_KCONFIG),$(if $(CONFIG_$c),CONFIG_$(c)=y))\
		modules
endef

define KernelPackage/mt7603e/install
	$(INSTALL_DIR) $(1)/lib/wifi/
	$(INSTALL_BIN) ./files/mt7603.sh $(1)/lib/wifi/
	$(INSTALL_DIR) $(1)/etc/Wireless/mt7603/
	$(INSTALL_BIN) ./files/mt7603.dat $(1)/etc/Wireless/mt7603/
	$(INSTALL_BIN) ./files/mt7603.dat $(1)/etc/Wireless/mt7603/mt7603.dat.orig
	-$(INSTALL_BIN) ./files/mt7603.eeprom.bin $(1)/etc/Wireless/mt7603/
endef

$(eval $(call KernelPackage,mt7603e))
